<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= typeof title !=='undefined' ? title : 'EduShare Connect' %>
    </title>
    <link rel="stylesheet" href="/css/style.css?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Notification Badge */
        .badge {
            position: absolute;
            top: -8px;
            right: -12px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.7rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Toast Container */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Toast Notification */
        .toast {
            background: white;
            border-left: 4px solid #4CAF50;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
            cursor: pointer;
        }

        .toast-content strong {
            display: block;
            color: #333;
            margin-bottom: 4px;
        }

        .toast-content p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Motivational Banner */
        .motivational-banner {
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            color: white;
            text-align: center;
            padding: 10px 0;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .motivational-banner i {
            color: #ffd700;
        }
    </style>
</head>

<body>
    <!-- Premium Weather & Time Widget -->
    <div id="premium-widget" class="premium-widget">
        <div class="widget-container">
            <div class="weather-section">
                <div class="weather-icon-wrapper">
                    <i id="weather-icon" class="fas fa-cloud"></i>
                </div>
                <div class="weather-info">
                    <span id="weather-temp" class="temp">--¬∞C</span>
                    <span id="weather-desc" class="condition">Loading...</span>
                </div>
                <div class="location-info">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="weather-loc">Detecting...</span>
                </div>
            </div>
            <div class="time-section">
                <div class="date-display" id="current-date"></div>
                <div class="time-display">
                    <i class="far fa-clock"></i>
                    <span id="current-time">--:--:--</span>
                </div>
            </div>
        </div>
    </div>

    <style>
        .premium-widget {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 0;
            position: relative;
            z-index: 1001;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .widget-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .weather-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weather-icon-wrapper {
            font-size: 1.5rem;
            color: #4b6cb7;
            filter: drop-shadow(0 2px 4px rgba(75, 108, 183, 0.2));
            animation: float 3s ease-in-out infinite;
        }

        .weather-info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .temp {
            font-weight: 700;
            font-size: 1.1rem;
            color: #1a202c;
        }

        .condition {
            font-size: 0.75rem;
            color: #4a5568;
            text-transform: capitalize;
        }

        .location-info {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            color: #718096;
            background: rgba(0, 0, 0, 0.03);
            padding: 4px 10px;
            border-radius: 20px;
            margin-left: 10px;
        }

        .location-info i {
            color: #e53e3e;
        }

        .time-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            line-height: 1.2;
        }

        .time-display {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1.2rem;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(90deg, #2d3748, #4a5568);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .date-display {
            font-size: 0.8rem;
            font-weight: 500;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-3px);
            }
        }

        @media (max-width: 768px) {
            .widget-container {
                flex-direction: column;
                gap: 8px;
            }

            .weather-section,
            .time-section {
                width: 100%;
                justify-content: center;
                align-items: center;
            }

            .location-info {
                display: none;
                /* Hide location on very small screens to save space */
            }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Time Update Function
            function updateTime() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-US', { hour12: true, hour: '2-digit', minute: '2-digit', second: '2-digit' });
                const dateStr = now.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' });

                document.getElementById('current-time').textContent = timeStr;
                document.getElementById('current-date').textContent = dateStr;
            }
            setInterval(updateTime, 1000);
            updateTime(); // Initial call

            // Weather Function
            async function fetchWeather() {
                const iconMap = {
                    0: 'fa-sun', // Clear sky
                    1: 'fa-cloud-sun', 2: 'fa-cloud-sun', 3: 'fa-cloud', // Cloudy
                    45: 'fa-smog', 48: 'fa-smog', // Fog
                    51: 'fa-cloud-rain', 53: 'fa-cloud-rain', 55: 'fa-cloud-showers-heavy', // Drizzle
                    61: 'fa-cloud-rain', 63: 'fa-cloud-rain', 65: 'fa-cloud-showers-heavy', // Rain
                    71: 'fa-snowflake', 73: 'fa-snowflake', 75: 'fa-snowflake', // Snow
                    95: 'fa-bolt', 96: 'fa-bolt', 99: 'fa-bolt' // Thunderstorm
                };

                try {
                    // 1. Get Location (IP-based)
                    let locData = { city: 'Dhaka', country_name: 'Bangladesh', latitude: 23.8103, longitude: 90.4125 };

                    try {
                        const locRes = await fetch('https://ipapi.co/json/');
                        if (locRes.ok) {
                            locData = await locRes.json();
                        }
                    } catch (e) {
                        console.warn('Location auto-detect failed, using default');
                    }

                    document.getElementById('weather-loc').textContent = `${locData.city || 'Dhaka'}, ${locData.country_name || 'Bangladesh'}`;

                    // 2. Get Weather (OpenMeteo)
                    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${locData.latitude || 23.8103}&longitude=${locData.longitude || 90.4125}&current_weather=true`);
                    const weatherData = await weatherRes.json();
                    const current = weatherData.current_weather;

                    // Update UI
                    document.getElementById('weather-temp').textContent = `${Math.round(current.temperature)}¬∞C`;

                    // Map WMO code to description/icon
                    document.getElementById('weather-desc').textContent = 'Live Weather'; // basic label

                    const iconClass = iconMap[current.weathercode] || 'fa-cloud';
                    const iconEl = document.getElementById('weather-icon');
                    iconEl.className = `fas ${iconClass}`;

                    // Colorize icon based on condition
                    if (current.weathercode === 0) iconEl.style.color = '#f6e05e'; // Sunny yellow
                    else if (current.weathercode >= 95) iconEl.style.color = '#805ad5'; // Storm purple
                    else iconEl.style.color = '#4b6cb7'; // Default blue

                } catch (err) {
                    console.error('Weather widget error:', err);
                    document.getElementById('weather-loc').textContent = 'Dhaka, Bangladesh';
                    document.getElementById('weather-temp').textContent = '--';
                }
            }

            fetchWeather();
        });
    </script>
    <div class="emoji-background">
        <div class="floating-emoji">üìö</div>
        <div class="floating-emoji">üéì</div>
        <div class="floating-emoji">‚úèÔ∏è</div>
        <div class="floating-emoji">üí°</div>
        <div class="floating-emoji">üî¨</div>
        <div class="floating-emoji">üé®</div>
        <div class="floating-emoji">üöÄ</div>
        <div class="floating-emoji">üß†</div>
        <div class="floating-emoji">üìù</div>
        <div class="floating-emoji">üåè</div>
    </div>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">EduShare Connect</a>

            <!-- Hamburger Menu Button -->
            <button class="hamburger" id="hamburger-btn" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <!-- Navigation Links -->
            <ul class="nav-links" id="nav-menu">
                <li><a href="/" class="nav-item-highlight"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="/resources" class="nav-item-highlight"><i class="fas fa-book"></i> Resources</a></li>
                <li><a href="/forums" class="nav-item-highlight"><i class="fas fa-comments-alt"></i> Discussion</a></li>
                <li><a href="/reels" class="nav-item-highlight"><i class="fas fa-video"></i> Reels</a></li>

                <% if (typeof user !=='undefined' && user) { %>
                    <li>
                        <a href="/communication" class="nav-item-highlight" style="position: relative;">
                            <i class="fas fa-comments"></i> Chat
                            <span id="msg-badge" class="badge" style="display: none;">0</span>
                        </a>
                    </li>
                    <li><a href="/premium" class="nav-item-highlight"><i class="fas fa-crown"></i> Premium</a></li>
                    <li><a href="/gamification/leaderboard" class="nav-item-highlight"><i class="fas fa-trophy"></i>
                            Leaderboard</a></li>
                    <li><a href="/portal" class="nav-item-highlight"><i class="fas fa-newspaper"></i> News & Jobs</a>
                    </li>
                    <li><a href="/ai/recommendations" class="nav-item-highlight"><i class="fas fa-magic"></i> AI
                            Picks</a></li>
                    <li><a href="/ai-assistant/chat" class="nav-item-highlight special"><i class="fas fa-robot"></i> AI
                            Assistant</a></li>
                    <li><a href="/resources/upload/new" class="nav-item-highlight"><i
                                class="fas fa-cloud-upload-alt"></i> Upload</a></li>
                    <li><a href="/profile/settings" class="nav-item-highlight"><i class="fas fa-user-cog"></i>
                            Profile</a></li>
                    <li class="user-menu">
                        <span class="user-welcome">Welcome, <%= user.username %></span>
                        <a href="/logout" class="btn-small">Logout</a>
                    </li>
                    <% } else { %>
                        <li><a href="/login" class="nav-item-highlight"><i class="fas fa-sign-in-alt"></i> Login</a>
                        </li>
                        <li><a href="/register" class="nav-item-highlight special"><i class="fas fa-user-plus"></i>
                                Register</a></li>
                        <% } %>
            </ul>
        </div>
    </nav>

    <!-- Hamburger Menu Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const hamburger = document.getElementById('hamburger-btn');
            const navMenu = document.getElementById('nav-menu');

            hamburger.addEventListener('click', function () {
                hamburger.classList.toggle('active');
                navMenu.classList.toggle('active');
                document.body.classList.toggle('menu-open');
            });

            // Close menu when clicking a link
            const navLinks = navMenu.querySelectorAll('a');
            navLinks.forEach(link => {
                link.addEventListener('click', function () {
                    hamburger.classList.remove('active');
                    navMenu.classList.remove('active');
                    document.body.classList.remove('menu-open');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', function (event) {
                if (!navMenu.contains(event.target) && !hamburger.contains(event.target)) {
                    hamburger.classList.remove('active');
                    navMenu.classList.remove('active');
                    document.body.classList.remove('menu-open');
                }
            });
        });
    </script>

    <!-- Motivational Banner -->
    <div class="motivational-banner">
        <i class="fas fa-lightbulb"></i>
        <span id="daily-quote">"Education is the most powerful weapon which you can use to change the world." ‚Äî Nelson
            Mandela</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const quotes = [
                "The expert in anything was once a beginner. ‚Äî Helen Hayes",
                "Education is the passport to the future. ‚Äî Malcolm X",
                "Keep going. Everything you need will come to you at the perfect time.",
                "You don't have to be great to start, but you have to start to be great. ‚Äî Zig Ziglar",
                "The way to get started is to quit talking and begin doing. ‚Äî Walt Disney",
                "Success is the sum of small efforts, repeated day in and day out. ‚Äî Robert Collier",
                "There are no shortcuts to any place worth going. ‚Äî Beverly Sills",
                "Motivation is what gets you started. Habit is what keeps you going. ‚Äî Jim Ryun",
                "Learning never exhausts the mind. ‚Äî Leonardo da Vinci",
                "Your attitude, not your aptitude, will determine your altitude. ‚Äî Zig Ziglar"
            ];
            const quoteElement = document.getElementById('daily-quote');
            if (quoteElement) {
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                quoteElement.textContent = randomQuote;
            }
        });
    </script>

    <div id="toast-container"></div>
    <main class="container">