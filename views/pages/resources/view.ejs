<%- include('../../partials/header') %>
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <h1>
                    <%= resource.title %>
                </h1>
                <p class="text-muted">
                    Uploaded by <%= resource.uploader ? resource.uploader.username : 'Unknown' %> on <%= new
                            Date(resource.createdAt).toLocaleDateString() %>
                </p>
            </div>
            <% if (resource.isPremium) { %>
                <span style="background: gold; padding: 5px 10px; border-radius: 4px; font-weight: bold;">Premium</span>
                <% } %>
        </div>

        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

        <% if (resource.fileType==='pdf' ) { %>
            <div style="margin-bottom: 30px;">
                <h3>Document Preview</h3>

                <div style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #525659;">
                    <iframe id="pdf-viewer" src="/resources/pdf-proxy/<%= resource._id %>" width="100%" height="700px"
                        style="border: none; display: block;">
                    </iframe>
                </div>

                <div
                    style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-left: 4px solid #2196F3; border-radius: 4px;">
                    <p style="margin: 0; color: #1565C0; font-size: 0.95rem;">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Tip:</strong> If the PDF doesn't display above, use the "Open in New Tab" button below
                        for full functionality.
                    </p>
                </div>
            </div>
            <% } %>

                <div class="grid" style="grid-template-columns: 2fr 1fr;">
                    <div>
                        <h3>Description</h3>
                        <p>
                            <%= resource.description %>
                        </p>

                        <div style="margin-top: 20px;">
                            <h3>Tags</h3>
                            <div>
                                <% resource.tags.forEach(tag=> { %>
                                    <span
                                        style="background: #e1f5fe; color: #0277bd; padding: 2px 8px; border-radius: 10px; margin-right: 5px; font-size: 0.9rem;">
                                        <%= tag %>
                                    </span>
                                    <% }) %>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f9f9f9; padding: 15px; border-radius: 8px;">
                        <h3>Details</h3>
                        <ul style="list-style: none; margin-top: 10px;">
                            <li><strong>Subject:</strong>
                                <%= resource.subject %>
                            </li>
                            <li><strong>Grade Level:</strong>
                                <%= resource.gradeLevel %>
                            </li>
                            <li><strong>Type:</strong>
                                <%= resource.fileType.toUpperCase() %>
                            </li>
                            <li><strong>Views:</strong>
                                <%= resource.views %>
                            </li>
                            <li><strong>Downloads:</strong>
                                <%= resource.downloads %>
                            </li>
                        </ul>

                        <h3 style="margin-top: 25px; margin-bottom: 15px;">Actions</h3>

                        <a href="/resources/pdf-proxy/<%= resource._id %>" class="btn"
                            style="width: 100%; text-align: center; background: #2196F3; margin-bottom: 10px; display: block; text-decoration: none;"
                            target="_blank">
                            <i class="fas fa-external-link-alt"></i> Open in New Tab
                        </a>

                        <a href="/resources/<%= resource._id %>/download" class="btn"
                            style="width: 100%; text-align: center; background: #4CAF50; display: block; text-decoration: none;">
                            <i class="fas fa-download"></i> Download PDF
                        </a>
                    </div>
                </div>
    </div>

    <script>
        // Fallback: If iframe fails to load, show helpful message
        const iframe = document.getElementById('pdf-viewer');
        if (iframe) {
            iframe.onerror = function () {
                iframe.style.display = 'none';
                const container = iframe.parentElement;
                container.innerHTML = '<div style="padding: 40px; text-align: center; color: #666;"><i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ff9800; margin-bottom: 20px;"></i><h3>Unable to display PDF preview</h3><p>Please use the "Open in New Tab" button below to view this document.</p></div>';
            };
        }
    </script>

    <%- include('../../partials/footer') %>